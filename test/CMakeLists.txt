cmake_minimum_required(VERSION 2.8)
cmake_policy(SET CMP0015 NEW)

# set include and link locations
find_package(LibXml2)
if(LIBXML2_FOUND)
        include_directories(${LIBXML2_INCLUDE_DIR})
endif()

include_directories(../../../trunk/src ../../../trunk/src/libsrcml)
link_directories(../../../trunk/bin)

# set compile and linker flags
add_definitions(-g)
add_definitions(--coverage)
add_definitions(-O0)
set(CMAKE_EXE_LINKER_FLAGS -fprofile-arcs)

# Build tests
add_executable(test_srcMLReader test_srcMLReader.cpp)
target_link_libraries(test_srcMLReader srcml ${LIBXML2_LIBRARIES})
#add_executable(test_srcMLSAX2Reader test_srcMLSAX2Reader.cpp)
#target_link_libraries(test_srcMLSAX2Reader srcml ${LIBXML2_LIBRARIES})
add_executable(test_srcml_append_transform test_srcml_append_transform.cpp)
target_link_libraries(test_srcml_append_transform srcml)
add_executable(test_srcml_apply_transforms test_srcml_apply_transforms.cpp)
target_link_libraries(test_srcml_apply_transforms srcml)
add_executable(test_srcml_archive_check_extension test_srcml_archive_check_extension.cpp)
target_link_libraries(test_srcml_archive_check_extension srcml)
add_executable(test_srcml_archive_get test_srcml_archive_get.cpp)
target_link_libraries(test_srcml_archive_get srcml)
add_executable(test_srcml_archive_set test_srcml_archive_set.cpp)
target_link_libraries(test_srcml_archive_set srcml)
add_executable(test_srcml_clear_transforms test_srcml_clear_transforms.cpp)
target_link_libraries(test_srcml_clear_transforms srcml)
add_executable(test_srcml_clone_archive test_srcml_clone_archive.cpp)
target_link_libraries(test_srcml_clone_archive srcml)
add_executable(test_srcml_create_archive test_srcml_create_archive.cpp)
target_link_libraries(test_srcml_create_archive srcml)
add_executable(test_srcml_create_unit test_srcml_create_unit.cpp)
target_link_libraries(test_srcml_create_unit srcml)
add_executable(test_srcml_extract_text test_srcml_extract_text.cpp)
target_link_libraries(test_srcml_extract_text srcml ${LIBXML2_LIBRARIES})
add_executable(test_srcml_global test_srcml_global.cpp)
target_link_libraries(test_srcml_global srcml)
add_executable(test_srcml_global_access test_srcml_global_access.cpp)
target_link_libraries(test_srcml_global_access srcml)
add_executable(test_srcml_list test_srcml_list.cpp)
target_link_libraries(test_srcml_list srcml)
add_executable(test_srcml_parse_unit test_srcml_parse_unit.cpp)
target_link_libraries(test_srcml_parse_unit srcml)
add_executable(test_srcml_read_open test_srcml_read_open.cpp)
target_link_libraries(test_srcml_read_open srcml)
add_executable(test_srcml_read_unit test_srcml_read_unit.cpp)
target_link_libraries(test_srcml_read_unit srcml)
add_executable(test_srcml_relaxng test_srcml_relaxng.cpp)
target_link_libraries(test_srcml_relaxng srcml ${LIBXML2_LIBRARIES})
add_executable(test_srcml_sax2_utilities test_srcml_sax2_utilities.cpp)
target_link_libraries(test_srcml_sax2_utilities srcml ${LIBXML2_LIBRARIES})
add_executable(test_srcml_unit_get test_srcml_unit_get.cpp)
target_link_libraries(test_srcml_unit_get srcml)
add_executable(test_srcml_unit_set test_srcml_unit_set.cpp)
target_link_libraries(test_srcml_unit_set srcml)
add_executable(test_srcml_unparse_unit test_srcml_unparse_unit.cpp)
target_link_libraries(test_srcml_unparse_unit srcml)
add_executable(test_srcml_write_open test_srcml_write_open.cpp)
target_link_libraries(test_srcml_write_open srcml)
add_executable(test_srcml_write_unit test_srcml_write_unit.cpp)
target_link_libraries(test_srcml_write_unit srcml)
add_executable(test_srcml_xpath test_srcml_xpath.cpp)
target_link_libraries(test_srcml_xpath srcml ${LIBXML2_LIBRARIES})
add_executable(test_srcml_xslt test_srcml_xslt.cpp)
target_link_libraries(test_srcml_xslt srcml ${LIBXML2_LIBRARIES})


# ctest
include(CTest)
enable_testing()
set(CTEST_DROP_SITE_CDASH FALSE)
set(MEMORYCHECK_COMMAND /usr/local/bin/valgrind)
set(COVERAGE_COMMAND /usr/bin/gcov)

add_test(NAME test_srcMLReader COMMAND test_srcMLReader)
#add_test(NAME test_srcMLSAX2Reader COMMAND test_srcMLSAX2Reader)
add_test(NAME test_srcml_append_transform COMMAND test_srcml_append_transform)
add_test(NAME test_srcml_apply_transforms COMMAND test_srcml_apply_transforms)
add_test(NAME test_srcml_archive_check_extension COMMAND test_srcml_archive_check_extension)
add_test(NAME test_srcml_archive_get COMMAND test_srcml_archive_get)
add_test(NAME test_srcml_archive_set COMMAND test_srcml_archive_set)
add_test(NAME test_srcml_clear_transforms COMMAND test_srcml_clear_transforms)
add_test(NAME test_srcml_clone_archive COMMAND test_srcml_clone_archive)
add_test(NAME test_srcml_create_archive COMMAND test_srcml_create_archive)
add_test(NAME test_srcml_create_unit COMMAND test_srcml_create_unit)
add_test(NAME test_srcml_extract_text COMMAND test_srcml_extract_text)
add_test(NAME test_srcml_global COMMAND test_srcml_global)
add_test(NAME test_srcml_global_access COMMAND test_srcml_global_access)
add_test(NAME test_srcml_list COMMAND test_srcml_list)
add_test(NAME test_srcml_parse_unit COMMAND test_srcml_parse_unit)
add_test(NAME test_srcml_read_open COMMAND test_srcml_read_open)
add_test(NAME test_srcml_read_unit COMMAND test_srcml_read_unit)
add_test(NAME test_srcml_relaxng COMMAND test_srcml_relaxng)
add_test(NAME test_srcml_sax2_utilities COMMAND test_srcml_sax2_utilities)
add_test(NAME test_srcml_unit_get COMMAND test_srcml_unit_get)
add_test(NAME test_srcml_unit_set COMMAND test_srcml_unit_set)
add_test(NAME test_srcml_unparse_unit COMMAND test_srcml_unparse_unit)
add_test(NAME test_srcml_write_open COMMAND test_srcml_write_open)
add_test(NAME test_srcml_write_unit COMMAND test_srcml_write_unit)
add_test(NAME test_srcml_xpath COMMAND test_srcml_xpath)
add_test(NAME test_srcml_xslt COMMAND test_srcml_xslt)
